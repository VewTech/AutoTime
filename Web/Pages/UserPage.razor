 @using Library

@page "/user"

<h3>Usuario</h3>

<p>Utiliza tus credenciales de intratime para iniciar sesión en el servicio</p>

Nombre de usuario (correo): <input @bind="_newUsername"/><br />
Contraseña: <input type="password" @bind="_newPassword" /><br />
<button @onclick="OnUserLogin">CONFIRMAR</button><br />

Actualmente has iniciado sesión como @_cachedUsername

@code {
    // The data the user interacts with in the form
    private string _newUsername = "";
    private string _newPassword = "";

    // The data saved in the browser caché
    private string _cachedUsername = "";

    // When the page loads, retrieve data from LocalStorageService
    protected async override void OnInitialized()
    {
        _cachedUsername = await LocalStorage.GetUsername();
        StateHasChanged();
    }

    // When the user tries to login, check credentials and, if correct, save to LocalStorageService
    private async void OnUserLogin()
    {
        await IntratimeService.LoginUser(_newUsername, _newPassword);
        await LocalStorage.SetUsername(_newUsername);
        await LocalStorage.SetPassword(_newPassword);
        _cachedUsername = _newUsername;
        StateHasChanged();
    }
}